
# 软件工具与针对特定设备编写的程序

## 程序分类
* 软件工具： `从stdin或文件读入，写到stdout。 对磁盘文件和设备文件不加区分`
> 可以重定向其stdio
* 特定设备程序： `为特定应用控制设备`
* 用户程序： `一种常见的设备相关程序`
> 如 vi、emacs、more等。 一般会：
  * 立即响应键盘事件
  * 有限输入集
  * 输入的超时
  * 屏蔽ctrl-C

# 终端驱动程序的模式

## 规范模式
`Canonical`，也被成为`cooked`模式，是常用的模式，特点如下：
* 缓冲
> 缓冲至遇到回车触发“提交”
* 编辑
> 即`可编辑`，比如可以用 <- （backspace）删除已输入（但没有回车的）内容


## 非规范处理
`stty -icanon` 可以取消规范模式，变化：
* 每一个输入的字符都会立即被读取方读取到
* 不可编辑，意味着读取方需要自行实现“编辑”功能（典型的就是backspace）

## raw 模式
> `每个处理步骤都有一个独立的位控制`，如 ISIG位控制ctrl-C键是否用于终止一个程序。 而`程序可以随意关闭这些处理步骤`
> 当所有处理都被关闭后，驱动程序会将输入直接传递给程序 - `raw模式`

# 编写一个用户程序： play_again.c
见 [code](code/06)

## 对信号的处理
例子代码中会在结束时恢复终端，而如果遇到异常情况提前退出（比如ctrl-C）的话这部分代码是不会执行的，导致退出后终端属性未恢复（如O_NDELAY），原shell可能会异常导致退出。
> bash/zsh等本身运行在raw模式下，当子进程退出后会立即重置终端属性，这样的话就不会“受害”

# 信号

## ctrl-C做什么

## 信号是什么

## 进程该如何处理信号

## 信号处理示例

# 为处理信号做准备

# 进程终止

# 为设备编程

# 小结
